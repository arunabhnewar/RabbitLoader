window.addEventListener("load",function(){AppNav.init(),RLAlert.init(),RLDataTable.setupDataTableDefaults(),DatePicker.init()});const AppNav={data:{selected_domain:"",selected_dr:null,all_domains:[]},onLogout:function(){RLCookie.eraseCookie("rl-selected-domain"),RLCookie.eraseCookie("urid"),RLCookie.eraseCookie("urauth"),RLCookie.eraseCookie("urname"),RLCookie.eraseCookie("urem"),AppNav.data={selected_domain:"",selected_dr:{},all_domains:[]}},isLoggedIn:function(){return RLCookie.getCookie("urid")&&RLCookie.getCookie("urauth")},wlh:function(e){window.location.hash=e},init:function(){RLPluginConnect.init();let e=AppNav.getCurrentViewName();if(window.addEventListener("hashchange",AppNav.navigate,!1),AppNav.isLoggedIn()){if(RLPluginConnect.isConnectRequest()){RLPluginConnect.checkDomainExists();return}e?e=window.location.hash.substring(1):window.location.href.indexOf("affiliate")>-1||window.location.href.indexOf("partner")>-1?e="partner":e="overview",AppNav.wlh(e),$("#nav-user-name").html(RLCookie.getCookie("urname"))}else e!="unsubscribe"&&AppNav.wlh("login");AppNav.navigate()},navigate:function(){let t=AppNav.getCurrentViewName();t||(console.log("viewName empty, setting to login"),t="login"),RLAlert.hideToast();try{currentPage.events.onUnMount()}catch{}let s=AppNav.showLoader();$("#content-area").load("/account/ui/"+t+".html?v="+LUT,function(){s.unblock(),AppNav.callOnMount()});let n=!1;AppNav.isLoggedIn()?(n=!1,$(".hideif-loggedout").show(),$(".hideif-loggedin").hide()):(n=!0,$(".hideif-loggedout").hide(),$(".hideif-loggedin").show()),t=="adddomain"&&(n=!0),n?$("#content-area").addClass("d-flex justify-content-center align-items-center"):$("#content-area").removeClass("d-flex justify-content-center align-items-center"),$(".all-domains-dropdown").closest(".dropdown-menu").removeClass("show"),DatePicker.hidePicker()},getCurrentViewName:function(){var e=location.hash.indexOf("/");return e===-1?location.hash.substring(1):location.hash.substring(1,e)},showLoader:function(e){return e||(e="#content-area"),$(e).block({message:'<i class="icon-spinner2 spinner"></i>',overlayCSS:{backgroundColor:"#333",opacity:.3,cursor:"wait","box-shadow":"0 0 0 1px #ddd"},css:{border:0,padding:0,backgroundColor:"none"}}),$(e)},callOnMount:function(){try{if(!window.currentPage)return;if(currentPage.data||(currentPage.data={}),currentPage.events&&currentPage.events.onMount){if(currentPage.data.onMountCalled){console.warn("onMountCalled already called");return}currentPage.data.onMountCalled=!0,currentPage.events.onMount()}let e=currentPage.data.doc_title;e||(e="Admin"),document.title=e+" - RabbitLoader";let t=document.querySelector("#breadcrumb-subpage");t&&(t.innerHTML=e),platformHandler.toggleOptions()}catch(e){console.warn(e)}},reshowTour:function(){let e="overview";RLTour.setForceStart(),AppNav.getCurrentViewName()==e?RLTour.autoStart():AppNav.wlh("overview")}},APIService=function(){function t(e){var t,n=e.serializeArray();return e.find("input:checkbox").map(function(){n.push({name:this.name,value:this.checked})}),t={},$.map(n,function(e){e.name.indexOf("[]")>=0||$('select[name="'+e.name+'"]').length==1&&$('select[name="'+e.name+'"]').prop("multiple")?(empty(t[e.name])&&(t[e.name]=new Array),t[e.name].push(e.value)):t[e.name]=e.value}),t}function a(e,n,s,o){return typeof s!="function"&&(s=function(){}),$.post("/api/v1/"+n,t($(e)),function(t){var i,n=document.querySelector(".laddaBtn");n!=null&&(i=Ladda.create(n),i.stop()),t.result?t.message&&(RLAlert.showToast("success",t.message),o&&$(e)[0].reset(),s(t)):t.message.localeCompare("AUTH_REQUIRED")==0?(RLAlert.showToast("error","Your session has expired. Please login again to continue."),AppNav.wlh("login")):RLAlert.showToast("error",t.message)}),!1}function o(e,n,o){let i=$(e).closest(".loader-block");$(e).off("submit").on("submit",function(a){a.preventDefault(),AppNav.showLoader(i);let r=t($(e));return s(n,"POST",r,function(e){e.result&&e.message&&RLAlert.showToast("success",e.message),o(e)},function(){i.unblock()}),!1})}function n(){return id=getNestedVal(AppNav.data,["selected_dr","id"]),host=getNestedVal(AppNav.data,["selected_dr","host"]),{host,id}}function s(t,s,o,i,a){let r=AppNav.showLoader(!1);if(o.hasOwnProperty("domain")&&!o.domain){let{host:e,id:t}=n();if(!e||!t){AppNav.wlh("domains");return}o.domain=e}o.hasOwnProperty("start_date")&&(o.start_date=DatePicker.start_date,o.end_date=DatePicker.end_date),typeof a!="function"&&(a=function(){}),$.ajax({url:"/api/v1/"+t,data:o,method:s}).done(function(e){r.unblock(),e.result?(e.message&&RLAlert.showToast("success",e.message),i(e)):e.message&&e.message.localeCompare("AUTH_REQUIRED")==0?(RLAlert.showToast("error","Your session has expired. Please login again to continue."),AppNav.wlh("login")):RLAlert.showToast("error",e.message||"Error"),a(e)}).fail(function(t){r.unblock(),e(t)})}function i(t,s,o,i,a){let r=AppNav.showLoader(!1);typeof a!="function"&&(a=function(){});let c="{domain_id}";if(t.indexOf(c)>-1){let{host:s,id:e}=n();if(!s||!e){AppNav.wlh("domains");return}t=t.replace(c,e)}$.ajax({url:"https://api-v2."+window.location.host+t,data:JSON.stringify(o),contentType:"application/json",method:s,headers:{Authorization:"Bearer "+RLCookie.getCookie("urauth")}}).done(function(e,t,n){r.unblock(),n&&[401,403].includes(n.status)?(RLAlert.showToast("error","Session expired, please login to continue."),AppNav.wlh("login")):n&&[200,202,204].includes(n.status)?i(n.status,e):RLAlert.showToast("error","Unexpected response "+n.status),a(e)}).fail(function(t){r.unblock(),e(t)})}function e(e){e&&[401,403].includes(e.status)?(RLAlert.showToast("error","Session expired, please login to continue."),AppNav.wlh("login")):e&&[400,404].includes(e.status)?RLAlert.showToast("error","Invalid request."):e&&e.status==503?RLAlert.showToast("error","Service temporary unavailable, please try in some time."):e&&e.responseJSON&&e.responseJSON.message?RLAlert.showToast("error",e.responseJSON.message):RLAlert.showToast("error","Network error, please try again.")}return{postData:s,postDataV2:i,onSubmit:o,handleXhrError:e}}();function setSelectedDomainDt(e,t){AppNav.data.selected_domain=t,AppNav.data.selected_dr={host:t,id:e},$(".rl-selected-domain").html('<a href="#domains" title="My Websites"><i class="icon-home4 mr-2 text-icon"></i></a> <span class="text-secondary">/</span> '+t+' <span class="text-secondary">/</span> <span id="breadcrumb-subpage"></span>'),RLCookie.setCookie("rl-selected-domain",t,999),$(".ns-based-on").hide(),$(".site-selected").show(),AppNav.wlh("overview")}const getNestedVal=(e,t)=>t.reduce((e,t)=>e&&e[t]?e[t]:null,e),setNestedVal=(e,t,n)=>{if(t.length===1){e[t]=n;return}return typeof e[t[0]]=="undefined"&&(e[t[0]]={}),setNestedVal(e[t[0]],t.slice(1),n)},formatBytes=function(e,t=2){if(!e||e===0||isNaN(e))return"0 Bytes";const n=1e3,o=t<0?0:t,i=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],s=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,s)).toFixed(o))+" "+i[s]},ucfirst=function(e){return e&&e.substr(0,1).toUpperCase()+e.substring(1)},RLFormatDate=function(e){return e?luxon.DateTime.fromISO(e).setLocale("en").toLocaleString(luxon.DateTime.DATETIME_MED):"-"},getTz=function(){let e="";try{e=luxon.DateTime.local().zoneName}catch(e){console.warn(e)}return e},RLDataTable={setupDataTableDefaults:function(){$.extend($.fn.dataTable.defaults,{autoWidth:!1,searchDelay:600,columnDefs:[{orderable:!1,width:100}],dom:'<"datatable-header"fBl><"datatable-scroll-wrap"tr><"datatable-footer"ip>',language:{search:"<span>Filter:</span> _INPUT_",searchPlaceholder:"Type to filter...",lengthMenu:"<span>Show:</span> _MENU_",paginate:{first:"First",last:"Last",next:$("html").attr("dir")=="rtl"?"&larr;":"&rarr;",previous:$("html").attr("dir")=="rtl"?"&rarr;":"&larr;"}},preDrawCallback:function(){}})}},RLAlert=function(){let t=null,e=null;function s(){t=swal.mixin({buttonsStyling:!1,confirmButtonClass:"btn btn-primary",cancelButtonClass:"btn btn-light"})}function o(s,o){n(),e=t.fire({text:o,type:s,toast:!0,position:"bottom",showConfirmButton:!1,timer:5e3})}function n(){e&&(e.close(),e=null)}function i(e,n,s){let o=e,i=[{k:"title",v:"Are you sure?"},{k:"text",v:"You won't be able to revert this!"},{k:"type",v:"warning"},{k:"showCancelButton",v:!0},{k:"confirmButtonText",v:"Yes, delete it!"},{k:"cancelButtonText",v:"No, cancel!"},{k:"confirmButtonClass",v:"btn btn-success"},{k:"cancelButtonClass",v:"btn btn-light"},{k:"buttonsStyling",v:!1}];i.forEach(e=>{e.k&&typeof o[e.k]=="undefined"&&(o[e.k]=e.v)}),t.fire(o).then(function(e){let t=e.dismiss===swal.DismissReason.cancel,o=e.dismiss===swal.DismissReason.backdrop||e.dismiss===swal.DismissReason.esc;t||o?s&&s(!!t):n(e.value)})}return{init:s,showToast:o,hideToast:n,showConfirm:i}}(),DatePicker={start_date:null,end_date:null,init:function(){$(".dropdown-date-select").on("change",DatePicker.onSelectionChange).val("28").trigger("change")},onSelectionChange:function(){let t=$(this).val();const n=luxon.DateTime.now();if(["7","28","90"].includes(t)){let e=0;t=parseInt(t)+e,DatePicker.start_date=n.plus({days:-1*t}).toISODate(),DatePicker.end_date=n.toISODate()}else t=="CM"?(DatePicker.start_date=n.startOf("month").toISODate(),DatePicker.end_date=n.endOf("month").toISODate()):t=="PM"&&(DatePicker.start_date=n.plus({months:-1}).startOf("month").toISODate(),DatePicker.end_date=n.plus({months:-1}).endOf("month").toISODate());window.currentPage&&currentPage.data&&(currentPage.data.onMountCalled=!1),AppNav.callOnMount()},showPicker:function(){if($(".dropdown-date-wrapper").show(),$(".dropdown-date-select").hasClass("select2-hidden-accessible"))return;$(".dropdown-date-select").select2({minimumResultsForSearch:1/0,dropdownAutoWidth:!0})},hidePicker:function(){$(".dropdown-date-wrapper").hide()}},getUrlParam=function(e){var t=new URL(window.location.href);return t.searchParams.get(e)},empty=function(e){return typeof e=="undefined"||!e},intVal=function(e){return e=parseInt(e),!e||e==isNaN(e)?0:e};var RLPluginConnect=function(){let e="",n="",a="",t="",o=!1,i=!1;const s="shopify";function l(){return!!(r()&&!i)&&(i=!0,e=getUrlParam("site_url"),n=getUrlParam("redirect_url"),a=getUrlParam("plugin_v"),!0)}function r(){if(!o){let i=getUrlParam("action")=="connect",e=getUrlParam("source")=="wp-plugin",n=getUrlParam("source")==s;o=i&&(e||n),n?t=s:e&&(t="wp")}return o}function d(){if(!AppNav.isLoggedIn())return;let s=$("#btn-free-init").closest(".modal-body");AppNav.showLoader(s),$.post("/api/v1/payment/free_domain",{website:e,platform:t},function(e){if(e.result)window.RLEvents&&RLEvents.triggerEvent("start_trial",{}),u(),s.unblock();else{e.message||(e.message="Unexpected error"),RLAlert.showToast("error",e.message);let t=`<div class="row"><div class="col-sm-12"><div><p>${e.message}</p></div><div><a href="${n}" class="btn btn-link"><i class="icon-circle-left2 mr-2"></i>Go back to Admin Panel</a><a href="#logout" class="btn btn-link"><i class="icon-enter mr-2"></i>Sign-in with a different account</a></div></div></div>`;$("#content-area").html(t)}}).fail(function(e){if(e.status==401){RLAlert.showToast("info","redirecting to login."),AppNav.wlh("login"),AppNav.navigate();return}RLAlert.showToast("error","Encountered network error. Please try again.")})}function u(){t!=s?h():c()}function h(){let n={title:"Do you run ads on this website?",html:'AdSense, AdThrive etc are some ad networks. If you confirm yes, speed score can only be improved to some extent without affecting ads impression. <a href="https://rabbitloader.com/kb/lazy-loading-of-adsense-ads/" target="_blank">Learn more</a>',confirmButtonText:"Yes, I run ads",confirmButtonClass:"btn btn-light",type:"question",showCancelButton:!0,cancelButtonText:"No, I dont run ads",cancelButtonClass:"btn btn-light",allowOutsideClick:!1,allowEscapeKey:!1},t=function(t){APIService.postData("rules/onboarding","POST",{domain:e,running_ads:t?"1":"0"},function(e){e.data?c():RLAlert.showToast("error","Unable to connect.")})};RLAlert.showConfirm(n,function(){t(!0)},function(){t(!1)})}function c(){APIService.postData("domain/getTokenForPlugin","GET",{domain:e,site_url:e,plugin_v:a,platform:t},function(e){e.data&&e.data.token?m(e.data.token):RLAlert.showToast("error","Unable to connect.")})}function m(t){!n||n.indexOf(e)!==0?RLAlert.showToast("error","Redirect URL is malformed. Please close the window and try again."):window.location=n+`&rl-token=${t}`}return{init:l,isConnectRequest:r,checkDomainExists:d}}(),copyText;const MailCat={mail_account_activity:{title:"Activity on my account",desc:"Important emails related to activity in your account. If this setting is turned off, RabbitLoader may still send you emails regarding your account, legal notifications and privacy matters"},mail_product_improvement:{title:"Product improvement",desc:"Emails related to product improvement including new features, etc"},mail_feedback_survey:{title:"Intermittent Feedback",desc:"Participate in RabbitLoader feedback and survey occurring not very frequent"}},contactSupport=function(){let e={title:"Contact Us",text:"You can drop us an email at support@rabbitloader.com with details and screenshot if applicable.",confirmButtonText:"Copy Email",type:"info",showCancelButton:!1};RLAlert.showConfirm(e,function(){const e=navigator.clipboard;e!==void 0&&e!=="undefined"&&navigator.clipboard.writeText("support@rabbitloader.com").then(function(){RLAlert.showToast("success","email address copied to clipboard")},function(){RLAlert.showToast("error","email address could not be copied")})})};copyText=function(e){var t=document.getElementById(e);t.setAttribute("type","text"),t.select(),t.setSelectionRange(0,99999),navigator.clipboard.writeText(t.value),RLAlert.showToast("success","Copied to clipboard")};const RlLoadJsCss=function(e){let t="setAttribute",n="addEventListener",s="createElement",o="appendChild";function i(i,a=!0,r){let c=e[s]("script");c[t]("src",i),c[t]("type","text/javascript"),c[t]("async",a),e.body[o](c),c[n]("load",r),c[n]("error",r)}function a(i,a){let r=e[s]("link");r[t]("href",i),r[t]("rel","stylesheet"),e.body[o](r),r[n]("load",a),r[n]("error",a)}return{js:i,css:a}}(document),RLTour=function(e,t){let i=!1,a="rl-tour",s=null,o=!1;function l(){return e.localStorage.getItem(a)}function r(){return e.localStorage.setItem(a,"1")}function n(e,n,s){let o={element:t.querySelector(e),intro:s};return n&&(o.title=n),o}let d=function(){return[n(".all-domains-btn","Your Websites","Here you can see all your websites and select the desired one."),n(".card-speed-score","Speed Score","See the top & average speed scores achieved for your website. It is an ongoing process and improves over time."),n("#card-body-image_comp_avg_cp","Optimization results","See the improvements for image & css Here."),n("#card-body-share","Delegation","If you need to invite a developer or manager you can do it here."),n("#table_page_score_wrapper","Speeds of individual pages.","Check speed scores & core web vital details of all individual pages of your website here."),n(".li-reports","See Reports","All reports including usage and billing are here"),n(".li-settings","Integration and Settings","This is the place to fine-tune the optimization for advanced users."),n(".li-actions","Actions","Purge website and it's history."),n(".li-help","Need Help","Find all the help you need here.")]};function u(){inlineStyle=t.createElement("style"),inlineStyle.textContent=".introjs-button{background: none;} .introjs-helperLayer{box-shadow:rgb(8 17 251 / 80%) 0px 0px 1px 2px, rgb(33 33 33 / 50%) 0px 0px 0px 5000px !important;}",t.head.appendChild(inlineStyle)}function h(){RlLoadJsCss.css("https://unpkg.com/intro.js/minified/introjs.min.css",function(){RlLoadJsCss.js("https://unpkg.com/intro.js@6.0.0/minified/intro.min.js",!0,function(){i=!0,u(),e.introJs&&(s=introJs().onexit(r).oncomplete(r))})})}function c(){i?(!l()||o)&&s&&(s.setOptions({steps:d()}).start(),o=!1):e.setTimeout(c,500)}function m(){o=!0}return h(),{autoStart:c,setForceStart:m}}(window,document);function asyncLoadRlCharts(e){if(window.rlCharts)e();else{var t=document.createElement("script");t.type="text/javascript",t.src="https://cfw.rabbitloader.xyz/rl/mfe/rl.charts.v3.10.8.js",t.onload=e,document.head.appendChild(t)}}const platformHandler=function(){_platformID="";function t(t){_platformID=t,e()}function n(){return _platformID}function e(){$(".plat-toggle").removeClass("d-none"),$(".plat-hide-"+_platformID).addClass("d-none")}return{setPlatform:t,getPlatform:n,toggleOptions:e}}()